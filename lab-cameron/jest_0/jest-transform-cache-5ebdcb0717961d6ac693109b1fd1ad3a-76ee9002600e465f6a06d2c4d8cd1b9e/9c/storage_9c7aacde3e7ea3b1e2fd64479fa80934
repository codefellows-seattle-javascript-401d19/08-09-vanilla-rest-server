27df98eb4c07c39bd3819bfdf2afa1f1
'use strict'; /* istanbul ignore next */var cov_1c27dld0r5 = function () {var path = '/home/cameron/Programming/CodeFellows/401/labs/08-09-vanilla-rest-server/lab-cameron/lib/storage.js',hash = '66e76c3c2280515fdd9732c7b0a324d22e7c7eee',global = new Function('return this')(),gcv = '__coverage__',coverageData = { path: '/home/cameron/Programming/CodeFellows/401/labs/08-09-vanilla-rest-server/lab-cameron/lib/storage.js', statementMap: { '0': { start: { line: 3, column: 15 }, end: { line: 3, column: 34 } }, '1': { start: { line: 4, column: 16 }, end: { line: 4, column: 35 } }, '2': { start: { line: 6, column: 16 }, end: { line: 6, column: 35 } }, '3': { start: { line: 8, column: 0 }, end: { line: 14, column: 5 } }, '4': { start: { line: 10, column: 4 }, end: { line: 13, column: 5 } }, '5': { start: { line: 11, column: 6 }, end: { line: 11, column: 64 } }, '6': { start: { line: 12, column: 6 }, end: { line: 12, column: 54 } }, '7': { start: { line: 16, column: 0 }, end: { line: 19, column: 2 } }, '8': { start: { line: 17, column: 2 }, end: { line: 17, column: 56 } }, '9': { start: { line: 18, column: 2 }, end: { line: 18, column: 52 } }, '10': { start: { line: 21, column: 0 }, end: { line: 33, column: 2 } }, '11': { start: { line: 22, column: 2 }, end: { line: 22, column: 63 } }, '12': { start: { line: 23, column: 2 }, end: { line: 23, column: 30 } }, '13': { start: { line: 25, column: 2 }, end: { line: 27, column: 3 } }, '14': { start: { line: 26, column: 4 }, end: { line: 26, column: 79 } }, '15': { start: { line: 29, column: 2 }, end: { line: 32, column: 7 } }, '16': { start: { line: 31, column: 6 }, end: { line: 31, column: 78 } }, '17': { start: { line: 35, column: 0 }, end: { line: 48, column: 2 } }, '18': { start: { line: 36, column: 2 }, end: { line: 36, column: 71 } }, '19': { start: { line: 37, column: 2 }, end: { line: 47, column: 7 } }, '20': { start: { line: 39, column: 6 }, end: { line: 39, column: 56 } }, '21': { start: { line: 39, column: 36 }, end: { line: 39, column: 54 } }, '22': { start: { line: 42, column: 6 }, end: { line: 44, column: 7 } }, '23': { start: { line: 43, column: 8 }, end: { line: 43, column: 60 } }, '24': { start: { line: 46, column: 6 }, end: { line: 46, column: 18 } }, '25': { start: { line: 50, column: 0 }, end: { line: 68, column: 2 } }, '26': { start: { line: 51, column: 2 }, end: { line: 51, column: 68 } }, '27': { start: { line: 53, column: 2 }, end: { line: 67, column: 7 } }, '28': { start: { line: 55, column: 25 }, end: { line: 57, column: 8 } }, '29': { start: { line: 56, column: 8 }, end: { line: 56, column: 34 } }, '30': { start: { line: 58, column: 6 }, end: { line: 58, column: 51 } }, '31': { start: { line: 59, column: 6 }, end: { line: 59, column: 47 } }, '32': { start: { line: 60, column: 6 }, end: { line: 62, column: 7 } }, '33': { start: { line: 61, column: 8 }, end: { line: 61, column: 44 } }, '34': { start: { line: 63, column: 6 }, end: { line: 63, column: 24 } }, '35': { start: { line: 66, column: 6 }, end: { line: 66, column: 72 } } }, fnMap: { '0': { name: '(anonymous_0)', decl: { start: { line: 9, column: 8 }, end: { line: 9, column: 9 } }, loc: { start: { line: 9, column: 18 }, end: { line: 14, column: 3 } }, line: 9 }, '1': { name: '(anonymous_1)', decl: { start: { line: 16, column: 19 }, end: { line: 16, column: 20 } }, loc: { start: { line: 16, column: 25 }, end: { line: 19, column: 1 } }, line: 16 }, '2': { name: '(anonymous_2)', decl: { start: { line: 21, column: 18 }, end: { line: 21, column: 19 } }, loc: { start: { line: 21, column: 26 }, end: { line: 33, column: 1 } }, line: 21 }, '3': { name: '(anonymous_3)', decl: { start: { line: 30, column: 10 }, end: { line: 30, column: 11 } }, loc: { start: { line: 30, column: 22 }, end: { line: 32, column: 5 } }, line: 30 }, '4': { name: '(anonymous_4)', decl: { start: { line: 35, column: 20 }, end: { line: 35, column: 21 } }, loc: { start: { line: 35, column: 26 }, end: { line: 48, column: 1 } }, line: 35 }, '5': { name: '(anonymous_5)', decl: { start: { line: 38, column: 10 }, end: { line: 38, column: 11 } }, loc: { start: { line: 38, column: 22 }, end: { line: 40, column: 5 } }, line: 38 }, '6': { name: '(anonymous_6)', decl: { start: { line: 39, column: 27 }, end: { line: 39, column: 28 } }, loc: { start: { line: 39, column: 36 }, end: { line: 39, column: 54 } }, line: 39 }, '7': { name: '(anonymous_7)', decl: { start: { line: 41, column: 10 }, end: { line: 41, column: 11 } }, loc: { start: { line: 41, column: 18 }, end: { line: 47, column: 5 } }, line: 41 }, '8': { name: '(anonymous_8)', decl: { start: { line: 50, column: 21 }, end: { line: 50, column: 22 } }, loc: { start: { line: 50, column: 27 }, end: { line: 68, column: 1 } }, line: 50 }, '9': { name: '(anonymous_9)', decl: { start: { line: 54, column: 10 }, end: { line: 54, column: 11 } }, loc: { start: { line: 54, column: 22 }, end: { line: 64, column: 5 } }, line: 54 }, '10': { name: '(anonymous_10)', decl: { start: { line: 55, column: 41 }, end: { line: 55, column: 42 } }, loc: { start: { line: 55, column: 49 }, end: { line: 57, column: 7 } }, line: 55 }, '11': { name: '(anonymous_11)', decl: { start: { line: 65, column: 10 }, end: { line: 65, column: 11 } }, loc: { start: { line: 65, column: 27 }, end: { line: 67, column: 5 } }, line: 65 } }, branchMap: { '0': { loc: { start: { line: 10, column: 4 }, end: { line: 13, column: 5 } }, type: 'if', locations: [{ start: { line: 10, column: 4 }, end: { line: 13, column: 5 } }, { start: { line: 10, column: 4 }, end: { line: 13, column: 5 } }], line: 10 }, '1': { loc: { start: { line: 25, column: 2 }, end: { line: 27, column: 3 } }, type: 'if', locations: [{ start: { line: 25, column: 2 }, end: { line: 27, column: 3 } }, { start: { line: 25, column: 2 }, end: { line: 27, column: 3 } }], line: 25 }, '2': { loc: { start: { line: 42, column: 6 }, end: { line: 44, column: 7 } }, type: 'if', locations: [{ start: { line: 42, column: 6 }, end: { line: 44, column: 7 } }, { start: { line: 42, column: 6 }, end: { line: 44, column: 7 } }], line: 42 }, '3': { loc: { start: { line: 60, column: 6 }, end: { line: 62, column: 7 } }, type: 'if', locations: [{ start: { line: 60, column: 6 }, end: { line: 62, column: 7 } }, { start: { line: 60, column: 6 }, end: { line: 62, column: 7 } }], line: 60 } }, s: { '0': 0, '1': 0, '2': 0, '3': 0, '4': 0, '5': 0, '6': 0, '7': 0, '8': 0, '9': 0, '10': 0, '11': 0, '12': 0, '13': 0, '14': 0, '15': 0, '16': 0, '17': 0, '18': 0, '19': 0, '20': 0, '21': 0, '22': 0, '23': 0, '24': 0, '25': 0, '26': 0, '27': 0, '28': 0, '29': 0, '30': 0, '31': 0, '32': 0, '33': 0, '34': 0, '35': 0 }, f: { '0': 0, '1': 0, '2': 0, '3': 0, '4': 0, '5': 0, '6': 0, '7': 0, '8': 0, '9': 0, '10': 0, '11': 0 }, b: { '0': [0, 0], '1': [0, 0], '2': [0, 0], '3': [0, 0] }, _coverageSchema: '332fd63041d2c1bcb487cc26dd0d5f7d97098a6c' },coverage = global[gcv] || (global[gcv] = {});if (coverage[path] && coverage[path].hash === hash) {return coverage[path];}coverageData.hash = hash;return coverage[path] = coverageData;}();

const logger = /* istanbul ignore next */(cov_1c27dld0r5.s[0]++, require('./logger'));
const fsExtra = /* istanbul ignore next */(cov_1c27dld0r5.s[1]++, require('fs-extra'));

const storage = /* istanbul ignore next */(cov_1c27dld0r5.s[2]++, module.exports = {}); /* istanbul ignore next */cov_1c27dld0r5.s[3]++;

fsExtra.pathExists(process.env.STORAGE_PATH).
then(result => {/* istanbul ignore next */cov_1c27dld0r5.f[0]++;cov_1c27dld0r5.s[4]++;
  if (!result) {/* istanbul ignore next */cov_1c27dld0r5.b[0][0]++;cov_1c27dld0r5.s[5]++;
    logger.log('verbose', 'STORAGE - creating an empty file'); /* istanbul ignore next */cov_1c27dld0r5.s[6]++;
    fsExtra.writeJSON(process.env.STORAGE_PATH, []);
  } else /* istanbul ignore next */{cov_1c27dld0r5.b[0][1]++;}
}); /* istanbul ignore next */cov_1c27dld0r5.s[7]++;

storage.fetchAll = () => {/* istanbul ignore next */cov_1c27dld0r5.f[1]++;cov_1c27dld0r5.s[8]++;
  logger.log('verbose', 'STORAGE - fetching all files'); /* istanbul ignore next */cov_1c27dld0r5.s[9]++;
  return fsExtra.readJSON(process.env.STORAGE_PATH);
}; /* istanbul ignore next */cov_1c27dld0r5.s[10]++;

storage.addItem = user => {/* istanbul ignore next */cov_1c27dld0r5.f[2]++;cov_1c27dld0r5.s[11]++;
  logger.log('verbose', 'STORAGE - adding the following user'); /* istanbul ignore next */cov_1c27dld0r5.s[12]++;
  logger.log('verbose', user); /* istanbul ignore next */cov_1c27dld0r5.s[13]++;

  if (!user.testId) {/* istanbul ignore next */cov_1c27dld0r5.b[1][0]++;cov_1c27dld0r5.s[14]++;
    return Promise.reject(new Error('__STORAGE_ERROR__ item must have an id'));
  } else /* istanbul ignore next */{cov_1c27dld0r5.b[1][1]++;}cov_1c27dld0r5.s[15]++;

  return storage.fetchAll().
  then(database => {/* istanbul ignore next */cov_1c27dld0r5.f[3]++;cov_1c27dld0r5.s[16]++;
    return fsExtra.writeJSON(process.env.STORAGE_PATH, [...database, user]);
  });
}; /* istanbul ignore next */cov_1c27dld0r5.s[17]++;

storage.fetchItem = id => {/* istanbul ignore next */cov_1c27dld0r5.f[4]++;cov_1c27dld0r5.s[18]++;
  logger.log('verbose', `STORAGE - fetching an item with an id ${id}`); /* istanbul ignore next */cov_1c27dld0r5.s[19]++;
  return storage.fetchAll().
  then(database => {/* istanbul ignore next */cov_1c27dld0r5.f[5]++;cov_1c27dld0r5.s[20]++;
    return database.find(user => {/* istanbul ignore next */cov_1c27dld0r5.f[6]++;cov_1c27dld0r5.s[21]++;return user.testId === id;});
  }).
  then(user => {/* istanbul ignore next */cov_1c27dld0r5.f[7]++;cov_1c27dld0r5.s[22]++;
    if (user === undefined) {/* istanbul ignore next */cov_1c27dld0r5.b[2][0]++;cov_1c27dld0r5.s[23]++;
      throw new Error('__STORAGE_ERROR__ item not found');
    } else /* istanbul ignore next */{cov_1c27dld0r5.b[2][1]++;}cov_1c27dld0r5.s[24]++;

    return user;
  });
}; /* istanbul ignore next */cov_1c27dld0r5.s[25]++;

storage.deleteItem = id => {/* istanbul ignore next */cov_1c27dld0r5.f[8]++;cov_1c27dld0r5.s[26]++;
  logger.log('verbose', `STORAGE - deleting an item with id ${id}`); /* istanbul ignore next */cov_1c27dld0r5.s[27]++;

  return storage.fetchAll().
  then(database => {/* istanbul ignore next */cov_1c27dld0r5.f[9]++;
    const filteredDB = /* istanbul ignore next */(cov_1c27dld0r5.s[28]++, database.filter(item => {/* istanbul ignore next */cov_1c27dld0r5.f[10]++;cov_1c27dld0r5.s[29]++;
      return item.testId !== id;
    })); /* istanbul ignore next */cov_1c27dld0r5.s[30]++;
    console.log('filteredDB', filteredDB.length); /* istanbul ignore next */cov_1c27dld0r5.s[31]++;
    console.log('database', database.length); /* istanbul ignore next */cov_1c27dld0r5.s[32]++;
    if (filteredDB.length === database.length) {/* istanbul ignore next */cov_1c27dld0r5.b[3][0]++;cov_1c27dld0r5.s[33]++;
      throw new Error('__NO_SUCH_USER__');
    } else /* istanbul ignore next */{cov_1c27dld0r5.b[3][1]++;}cov_1c27dld0r5.s[34]++;
    return filteredDB;
  }).
  then(filteredItems => {/* istanbul ignore next */cov_1c27dld0r5.f[11]++;cov_1c27dld0r5.s[35]++;
    return fsExtra.writeJSON(process.env.STORAGE_PATH, filteredItems);
  });
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInN0b3JhZ2UuanMiXSwibmFtZXMiOlsibG9nZ2VyIiwicmVxdWlyZSIsImZzRXh0cmEiLCJzdG9yYWdlIiwibW9kdWxlIiwiZXhwb3J0cyIsInBhdGhFeGlzdHMiLCJwcm9jZXNzIiwiZW52IiwiU1RPUkFHRV9QQVRIIiwidGhlbiIsInJlc3VsdCIsImxvZyIsIndyaXRlSlNPTiIsImZldGNoQWxsIiwicmVhZEpTT04iLCJhZGRJdGVtIiwidXNlciIsInRlc3RJZCIsIlByb21pc2UiLCJyZWplY3QiLCJFcnJvciIsImRhdGFiYXNlIiwiZmV0Y2hJdGVtIiwiaWQiLCJmaW5kIiwidW5kZWZpbmVkIiwiZGVsZXRlSXRlbSIsImZpbHRlcmVkREIiLCJmaWx0ZXIiLCJpdGVtIiwiY29uc29sZSIsImxlbmd0aCIsImZpbHRlcmVkSXRlbXMiXSwibWFwcGluZ3MiOiJBQUFBLGE7O0FBRUEsTUFBTUEsMkRBQVNDLFFBQVEsVUFBUixDQUFULENBQU47QUFDQSxNQUFNQyw0REFBVUQsUUFBUSxVQUFSLENBQVYsQ0FBTjs7QUFFQSxNQUFNRSw0REFBVUMsT0FBT0MsT0FBUCxHQUFpQixFQUEzQixDQUFOLEM7O0FBRUFILFFBQVFJLFVBQVIsQ0FBbUJDLFFBQVFDLEdBQVIsQ0FBWUMsWUFBL0I7QUFDR0MsSUFESCxDQUNRQyxVQUFVO0FBQ2QsTUFBSSxDQUFDQSxNQUFMLEVBQWE7QUFDWFgsV0FBT1ksR0FBUCxDQUFXLFNBQVgsRUFBc0Isa0NBQXRCLEVBRFc7QUFFWFYsWUFBUVcsU0FBUixDQUFrQk4sUUFBUUMsR0FBUixDQUFZQyxZQUE5QixFQUE0QyxFQUE1QztBQUNELEdBSEQ7QUFJRCxDQU5ILEU7O0FBUUFOLFFBQVFXLFFBQVIsR0FBbUIsTUFBTTtBQUN2QmQsU0FBT1ksR0FBUCxDQUFXLFNBQVgsRUFBc0IsOEJBQXRCLEVBRHVCO0FBRXZCLFNBQU9WLFFBQVFhLFFBQVIsQ0FBaUJSLFFBQVFDLEdBQVIsQ0FBWUMsWUFBN0IsQ0FBUDtBQUNELENBSEQsQzs7QUFLQU4sUUFBUWEsT0FBUixHQUFrQkMsUUFBUTtBQUN4QmpCLFNBQU9ZLEdBQVAsQ0FBVyxTQUFYLEVBQXNCLHFDQUF0QixFQUR3QjtBQUV4QlosU0FBT1ksR0FBUCxDQUFXLFNBQVgsRUFBc0JLLElBQXRCLEVBRndCOztBQUl4QixNQUFJLENBQUNBLEtBQUtDLE1BQVYsRUFBa0I7QUFDaEIsV0FBT0MsUUFBUUMsTUFBUixDQUFlLElBQUlDLEtBQUosQ0FBVSx3Q0FBVixDQUFmLENBQVA7QUFDRCxHQUZELDJEQUp3Qjs7QUFReEIsU0FBT2xCLFFBQVFXLFFBQVI7QUFDSkosTUFESSxDQUNDWSxZQUFZO0FBQ2hCLFdBQU9wQixRQUFRVyxTQUFSLENBQWtCTixRQUFRQyxHQUFSLENBQVlDLFlBQTlCLEVBQTRDLENBQUMsR0FBR2EsUUFBSixFQUFjTCxJQUFkLENBQTVDLENBQVA7QUFDRCxHQUhJLENBQVA7QUFJRCxDQVpELEM7O0FBY0FkLFFBQVFvQixTQUFSLEdBQW9CQyxNQUFNO0FBQ3hCeEIsU0FBT1ksR0FBUCxDQUFXLFNBQVgsRUFBdUIseUNBQXdDWSxFQUFHLEVBQWxFLEVBRHdCO0FBRXhCLFNBQU9yQixRQUFRVyxRQUFSO0FBQ0pKLE1BREksQ0FDQ1ksWUFBWTtBQUNoQixXQUFPQSxTQUFTRyxJQUFULENBQWNSLFFBQVMsb0ZBQUtDLE1BQUwsS0FBZ0JNLEVBQWhCLENBQWtCLENBQXpDLENBQVA7QUFDRCxHQUhJO0FBSUpkLE1BSkksQ0FJQ08sUUFBUTtBQUNaLFFBQUlBLFNBQVNTLFNBQWIsRUFBd0I7QUFDdEIsWUFBTSxJQUFJTCxLQUFKLENBQVUsa0NBQVYsQ0FBTjtBQUNELEtBRkQsMkRBRFk7O0FBS1osV0FBT0osSUFBUDtBQUNELEdBVkksQ0FBUDtBQVdELENBYkQsQzs7QUFlQWQsUUFBUXdCLFVBQVIsR0FBcUJILE1BQU07QUFDekJ4QixTQUFPWSxHQUFQLENBQVcsU0FBWCxFQUF1QixzQ0FBcUNZLEVBQUcsRUFBL0QsRUFEeUI7O0FBR3pCLFNBQU9yQixRQUFRVyxRQUFSO0FBQ0pKLE1BREksQ0FDQ1ksWUFBWTtBQUNoQixVQUFNTSxnRUFBYU4sU0FBU08sTUFBVCxDQUFnQkMsUUFBUTtBQUN6QyxhQUFPQSxLQUFLWixNQUFMLEtBQWdCTSxFQUF2QjtBQUNELEtBRmtCLENBQWIsQ0FBTixDQURnQjtBQUloQk8sWUFBUW5CLEdBQVIsQ0FBWSxZQUFaLEVBQTBCZ0IsV0FBV0ksTUFBckMsRUFKZ0I7QUFLaEJELFlBQVFuQixHQUFSLENBQVksVUFBWixFQUF3QlUsU0FBU1UsTUFBakMsRUFMZ0I7QUFNaEIsUUFBSUosV0FBV0ksTUFBWCxLQUFzQlYsU0FBU1UsTUFBbkMsRUFBMkM7QUFDekMsWUFBTSxJQUFJWCxLQUFKLENBQVUsa0JBQVYsQ0FBTjtBQUNELEtBRkQsMkRBTmdCO0FBU2hCLFdBQU9PLFVBQVA7QUFDRCxHQVhJO0FBWUpsQixNQVpJLENBWUN1QixpQkFBaUI7QUFDckIsV0FBTy9CLFFBQVFXLFNBQVIsQ0FBa0JOLFFBQVFDLEdBQVIsQ0FBWUMsWUFBOUIsRUFBNEN3QixhQUE1QyxDQUFQO0FBQ0QsR0FkSSxDQUFQO0FBZUQsQ0FsQkQiLCJmaWxlIjoic3RvcmFnZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3QgbG9nZ2VyID0gcmVxdWlyZSgnLi9sb2dnZXInKTtcbmNvbnN0IGZzRXh0cmEgPSByZXF1aXJlKCdmcy1leHRyYScpO1xuXG5jb25zdCBzdG9yYWdlID0gbW9kdWxlLmV4cG9ydHMgPSB7fTtcblxuZnNFeHRyYS5wYXRoRXhpc3RzKHByb2Nlc3MuZW52LlNUT1JBR0VfUEFUSClcbiAgLnRoZW4ocmVzdWx0ID0+IHtcbiAgICBpZiAoIXJlc3VsdCkge1xuICAgICAgbG9nZ2VyLmxvZygndmVyYm9zZScsICdTVE9SQUdFIC0gY3JlYXRpbmcgYW4gZW1wdHkgZmlsZScpO1xuICAgICAgZnNFeHRyYS53cml0ZUpTT04ocHJvY2Vzcy5lbnYuU1RPUkFHRV9QQVRILCBbXSk7XG4gICAgfVxuICB9KTtcblxuc3RvcmFnZS5mZXRjaEFsbCA9ICgpID0+IHtcbiAgbG9nZ2VyLmxvZygndmVyYm9zZScsICdTVE9SQUdFIC0gZmV0Y2hpbmcgYWxsIGZpbGVzJyk7XG4gIHJldHVybiBmc0V4dHJhLnJlYWRKU09OKHByb2Nlc3MuZW52LlNUT1JBR0VfUEFUSCk7XG59O1xuXG5zdG9yYWdlLmFkZEl0ZW0gPSB1c2VyID0+IHtcbiAgbG9nZ2VyLmxvZygndmVyYm9zZScsICdTVE9SQUdFIC0gYWRkaW5nIHRoZSBmb2xsb3dpbmcgdXNlcicpO1xuICBsb2dnZXIubG9nKCd2ZXJib3NlJywgdXNlcik7XG5cbiAgaWYgKCF1c2VyLnRlc3RJZCkge1xuICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoJ19fU1RPUkFHRV9FUlJPUl9fIGl0ZW0gbXVzdCBoYXZlIGFuIGlkJykpO1xuICB9XG5cbiAgcmV0dXJuIHN0b3JhZ2UuZmV0Y2hBbGwoKVxuICAgIC50aGVuKGRhdGFiYXNlID0+IHtcbiAgICAgIHJldHVybiBmc0V4dHJhLndyaXRlSlNPTihwcm9jZXNzLmVudi5TVE9SQUdFX1BBVEgsIFsuLi5kYXRhYmFzZSwgdXNlcl0pO1xuICAgIH0pO1xufTtcblxuc3RvcmFnZS5mZXRjaEl0ZW0gPSBpZCA9PiB7XG4gIGxvZ2dlci5sb2coJ3ZlcmJvc2UnLCBgU1RPUkFHRSAtIGZldGNoaW5nIGFuIGl0ZW0gd2l0aCBhbiBpZCAke2lkfWApO1xuICByZXR1cm4gc3RvcmFnZS5mZXRjaEFsbCgpXG4gICAgLnRoZW4oZGF0YWJhc2UgPT4ge1xuICAgICAgcmV0dXJuIGRhdGFiYXNlLmZpbmQodXNlciA9PiAgdXNlci50ZXN0SWQgPT09IGlkKTtcbiAgICB9KVxuICAgIC50aGVuKHVzZXIgPT4ge1xuICAgICAgaWYgKHVzZXIgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ19fU1RPUkFHRV9FUlJPUl9fIGl0ZW0gbm90IGZvdW5kJyk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB1c2VyO1xuICAgIH0pO1xufTtcblxuc3RvcmFnZS5kZWxldGVJdGVtID0gaWQgPT4ge1xuICBsb2dnZXIubG9nKCd2ZXJib3NlJywgYFNUT1JBR0UgLSBkZWxldGluZyBhbiBpdGVtIHdpdGggaWQgJHtpZH1gKTtcblxuICByZXR1cm4gc3RvcmFnZS5mZXRjaEFsbCgpXG4gICAgLnRoZW4oZGF0YWJhc2UgPT4ge1xuICAgICAgY29uc3QgZmlsdGVyZWREQiA9IGRhdGFiYXNlLmZpbHRlcihpdGVtID0+IHtcbiAgICAgICAgcmV0dXJuIGl0ZW0udGVzdElkICE9PSBpZDtcbiAgICAgIH0pO1xuICAgICAgY29uc29sZS5sb2coJ2ZpbHRlcmVkREInLCBmaWx0ZXJlZERCLmxlbmd0aCk7XG4gICAgICBjb25zb2xlLmxvZygnZGF0YWJhc2UnLCBkYXRhYmFzZS5sZW5ndGgpO1xuICAgICAgaWYgKGZpbHRlcmVkREIubGVuZ3RoID09PSBkYXRhYmFzZS5sZW5ndGgpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdfX05PX1NVQ0hfVVNFUl9fJyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmlsdGVyZWREQjtcbiAgICB9KVxuICAgIC50aGVuKGZpbHRlcmVkSXRlbXMgPT4ge1xuICAgICAgcmV0dXJuIGZzRXh0cmEud3JpdGVKU09OKHByb2Nlc3MuZW52LlNUT1JBR0VfUEFUSCwgZmlsdGVyZWRJdGVtcyk7XG4gICAgfSk7XG59O1xuIl19